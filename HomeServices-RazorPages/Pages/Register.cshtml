@page
@using App.Domain.Core.Contracts.Service.BaseEntities
@model HomeServices_RazorPages.Pages.RegisterModel
@inject IBaseDataService _BaseDataService;

@{
    var cities = await _BaseDataService.GetCities(default);
}

<section id="main" class="clearfix user-page">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-8 offset-md-2 col-lg-6 offset-lg-3">
                <div class="user-account">
                    <h2>ساخت اکانت</h2>
                    <form method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>

                        <div class="form-group">
                            <input asp-for="User.UserName" type="text" class="form-control" placeholder="نام کاربری" required>
                            <span asp-validation-for="User.UserName" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <input asp-for="User.Password" type="password" class="form-control" placeholder="رمزعبور" required>
                            <span asp-validation-for="User.Password" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <input asp-for="User.RePassword" type="password" class="form-control" placeholder="تایید رمزعبور" required>
                            <span asp-validation-for="User.RePassword" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <select asp-for="User.RoleId" class="form-control" id="roleSelect" required>
                                <option value="">انتخاب نقش</option>
                                <option value="2">مشتری</option>
                                <option value="3">متخصص</option>
                            </select>
                            <span asp-validation-for="User.RoleId" class="text-danger"></span>
                        </div>

                        <div id="customerFields" class="form-group d-none">
                            <input asp-for="User.Address" type="text" class="form-control" placeholder="آدرس">
                            <span asp-validation-for="User.Address" class="text-danger"></span>
                            <select asp-for="User.City.Id" class="form-control" id="citySelect">
                                <option value="">انتخاب شهر</option>
                                @foreach (var city in cities)
                                {
                                    <option value="@city.Id">@city.Name</option>
                                }
                            </select>
                            <span asp-validation-for="User.City.Id" class="text-danger"></span>
                        </div>

                        <div id="expertFields" class="form-group d-none">
                            <select asp-for="User.City.Id" class="form-control" id="citySelect">
                                <option value="">انتخاب شهر</option>
                                @foreach (var city in cities)
                                {
                                    <option value="@city.Id">@city.Name</option>
                                }
                            </select>
                            <span asp-validation-for="User.City.Id" class="text-danger"></span>
                        </div>

                        <div class="checkbox">
                            <label for="signing">
                                <input type="checkbox" name="signing" id="signing" required>
                                با ثبت نام اقرار میکنم تمامی قوانین و مقررات سایت را قبول کرده‌ام
                            </label>
                        </div>

                        <button type="submit" class="btn">ثبت‌نام</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var roleSelect = document.getElementById("roleSelect");
        var customerFields = document.getElementById("customerFields");
        var expertFields = document.getElementById("expertFields");
        var citySelect = document.getElementById("citySelect");

        function toggleFields() {
            var selectedRole = roleSelect.value;
            customerFields.classList.toggle("d-none", selectedRole !== "2");
            expertFields.classList.toggle("d-none", selectedRole !== "3");

            citySelect.required = selectedRole === "3";
        }

        roleSelect.addEventListener("change", toggleFields);
        toggleFields();
    });
</script>